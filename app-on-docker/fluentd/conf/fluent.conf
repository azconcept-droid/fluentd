<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>

# Parse Docker JSON logs
<filter nestjs.app>
  @type parser
  key_name log
  reserve_data true
  <parse>
    @type json
  </parse>
</filter>

# Add metadata
<filter nestjs.app>
  @type record_transformer
  <record>
    app nestjs
    container_id ${record["container_id"]}
    container_name ${record["container_name"]}
  </record>
</filter>

# Send to Loki
<match nestjs.app>
  @type loki
  url http://loki:3100
  extra_labels {"source":"nestjs","env":"production"}
  flush_interval 5s
  flush_at_shutdown true
  buffer_chunk_limit 1m
  <label>
    app
    type
    level
    container_name
  </label>
</match>
